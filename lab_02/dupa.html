<!DOCTYPE html>

<html>

<head>
    <title>Lab 02 - Jakub Worek</title>
    <script type="text/javascript" src="three.js"></script>
    <script type="text/javascript" src="jquery-1.9.0.js"></script>
    <script type="text/javascript" src="stats.js"></script>
    <script type="text/javascript" src="dat.gui.js"></script>
	<script type="text/javascript" src="OrbitControls.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: black; /* Dodajemy nocne tło */
        }
    </style>
</head>
<body>

<div id="Stats-output"></div>
<div id="WebGL-output"></div>

<script type="text/javascript">
    var stats = initStats();

    var scene = new THREE.Scene();

    // Ustawienie kamery
    var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.x = -25;
    camera.position.y = 30;
    camera.position.z = 25;
    camera.lookAt(new THREE.Vector3(10, 0, 0));

    var renderer = new THREE.WebGLRenderer();
    renderer.setClearColor(new THREE.Color(0x000000));  // tło nocne
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;

    var ctr = new THREE.OrbitControls(camera, renderer.domElement);

    // Tworzenie płaszczyzny
    var planeGeometry = new THREE.PlaneGeometry(60, 20, 15, 5);
    var planeMaterial = new THREE.MeshPhongMaterial({color: 0x333333, side: THREE.DoubleSide});
    var plane = new THREE.Mesh(planeGeometry, planeMaterial);
    plane.receiveShadow = true;

    plane.rotation.x = -0.5 * Math.PI;
    plane.position.x = 15;
    plane.position.y = 0;
    plane.position.z = 0;

    scene.add(plane);

    // Tworzenie dynamicznej kostki
    var cubeGeometry = new THREE.BoxGeometry(4, 4, 4);
    var cubeMaterial = new THREE.MeshPhongMaterial({color: 0xff0000, specular: true, shininess: 100});
    var cube = new THREE.Mesh(cubeGeometry, cubeMaterial);
    cube.castShadow = true;

    cube.position.x = -4;
    cube.position.y = 3;
    cube.position.z = 0;

    scene.add(cube);

    // Tworzenie dynamicznej kuli
    var sphereGeometry = new THREE.SphereGeometry(4, 20, 20);
    var sphereMaterial = new THREE.MeshPhongMaterial({color: 0x7777ff, specular: true, shininess: 100});
    var sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);

    sphere.position.x = 20;
    sphere.position.y = 0;
    sphere.position.z = 2;
    sphere.castShadow = true;

    scene.add(sphere);

    // Dynamiczne kolorowe źródła światła
    var light1 = createColoredSpotlight(0xffa500, 0, 40, 20); // Pomarańczowe światło
    var light2 = createColoredSpotlight(0x00ff00, 0, 20, -40); // Zielone światło
    var light3 = createColoredSpotlight(0x0000ff, -40, 20, 0); // Niebieskie światło

    scene.add(light1, light2, light3);

    // Ambientowe światło dla delikatnego rozjaśnienia sceny
    var ambientLight = new THREE.AmbientLight(0x111111);
    scene.add(ambientLight);

    $("#WebGL-output").append(renderer.domElement);

    var step = 0;

    var controls = new function () {
        this.rotationSpeed = 0.02;
        this.bouncingSpeed = 0.03;
        this.ambientColor = 0x111111;
    };

    var gui = new dat.GUI();
    gui.addColor(controls, 'ambientColor').onChange(function (e) {
        ambientLight.color = new THREE.Color(e);
    });

    render();

    function render() {
        stats.update();

        // Rotacja kostki
        cube.rotation.x += controls.rotationSpeed;
        cube.rotation.y += controls.rotationSpeed;
        cube.rotation.z += controls.rotationSpeed;

        // Ruch kuli góra-dół
        step += controls.bouncingSpeed;
        sphere.position.x = 20 + (10 * (Math.cos(step)));
        sphere.position.y = 2 + (10 * Math.abs(Math.sin(step)));

        // Dynamiczny ruch świateł
        light1.position.x = 30 * Math.cos(step / 4);
        light1.position.z = 30 * Math.sin(step / 4);

        light2.position.y = 30 + 10 * Math.sin(step / 3);

        light3.position.x = 30 * Math.cos(step / 5);
        light3.position.z = 30 * Math.sin(step / 5);

        requestAnimationFrame(render);
        renderer.render(scene, camera);
    }

    function createColoredSpotlight(color, x, y, z) {
        var spotLight = new THREE.SpotLight(color);
        spotLight.position.set(x, y, z);
        spotLight.castShadow = true;
        spotLight.angle = 0.3;
        spotLight.penumbra = 0.5;

        // Snop światła
        var coneGeometry = new THREE.ConeGeometry(10, 30, 30);
        var coneMaterial = new THREE.MeshBasicMaterial({color: color, transparent: true, opacity: 0.4});
        var cone = new THREE.Mesh(coneGeometry, coneMaterial);
        cone.position.set(0, -15, 0);
        cone.rotation.x = Math.PI / 2;

        var lightGroup = new THREE.Group();
        lightGroup.add(spotLight);
        lightGroup.add(cone);
        lightGroup.position.set(x, y, z);

        return lightGroup;
    }

    function initStats() {
        var stats = new Stats();
        stats.setMode(0);

        stats.domElement.style.position = 'absolute';
        stats.domElement.style.left = '0px';
        stats.domElement.style.top = '0px';

        $("#Stats-output").append(stats.domElement);

        return stats;
    }
</script>
</body>
</html>
